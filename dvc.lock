schema: '2.0'
stages:
  data_ingestion:
    cmd: python -m src.data.data_ingestion
    deps:
    - path: src/data/data_ingestion.py
      hash: md5
      md5: 568286c97e10bbfe0a97d2f7dddb3b5a
      size: 1317
    - path: src/db/engine.py
      hash: md5
      md5: a803a50473ceb1275c58d60cf8a83cfa
      size: 438
    params:
      params.yaml:
        data.data_version: 1
        database:
          view_name: hospital_data_flattened
          connection_from_env: true
        paths.raw_data: data/raw/raw.csv
    outs:
    - path: data/raw/raw.csv
      hash: md5
      md5: 43b4a658d1319a9da495fa5a3730aec1
      size: 2115634
  data_cleaning:
    cmd: python -m src.data.data_cleaning
    deps:
    - path: data/raw/raw.csv
      hash: md5
      md5: 43b4a658d1319a9da495fa5a3730aec1
      size: 2115634
    - path: src/data/data_cleaning.py
      hash: md5
      md5: 8bde49a681003bddabca0a55a79187da
      size: 1114
    outs:
    - path: data/interim/cleaned_data.csv
      hash: md5
      md5: 43b4a658d1319a9da495fa5a3730aec1
      size: 2115634
  feature_engineering:
    cmd: python -m src.features.feature_engineering
    deps:
    - path: data/interim/cleaned_data.csv
      hash: md5
      md5: 43b4a658d1319a9da495fa5a3730aec1
      size: 2115634
    - path: src/features/feature_engineering.py
      hash: md5
      md5: 55b22a85ae794cc267b7b158ccb2ad55
      size: 4311
    outs:
    - path: data/processed/featured_data.csv
      hash: md5
      md5: 89086eae43ce86ca571fd85a8c288d4a
      size: 622445
    - path: models/feature_info.json
      hash: md5
      md5: 382edaea61f88438fb8d0649436778a8
      size: 569
  data_split:
    cmd: python -m src.features.data_split
    deps:
    - path: data/processed/featured_data.csv
      hash: md5
      md5: 89086eae43ce86ca571fd85a8c288d4a
      size: 622445
    - path: src/features/data_split.py
      hash: md5
      md5: c021be792c0494d9ee32a98fa8d0a630
      size: 2049
    outs:
    - path: data/final/test.csv
      hash: md5
      md5: 2ac92cf9fe5ca4b95cd4e32b0f9b0727
      size: 121654
    - path: data/final/train.csv
      hash: md5
      md5: 2e0b36ca56fe77dbe1a6d970df046ee5
      size: 486171
  training_eval:
    cmd: python -m src.model.training_eval
    deps:
    - path: data/final/test.csv
      hash: md5
      md5: 2ac92cf9fe5ca4b95cd4e32b0f9b0727
      size: 121654
    - path: data/final/train.csv
      hash: md5
      md5: 2e0b36ca56fe77dbe1a6d970df046ee5
      size: 486171
    - path: src/model/training_eval.py
      hash: md5
      md5: 1515cd1255f7cfa9bd9a4bb6c93ab19d
      size: 8351
    outs:
    - path: models/candidate_label_encoders.pkl
      hash: md5
      md5: b238265b15871859fa489e502ce946f2
      size: 678
    - path: models/candidate_target_encoder.pkl
      hash: md5
      md5: 82e90dbfc9de9e2e115e25b02340ca01
      size: 3672
    - path: models/metrics/candidate_evaluation.json
      hash: md5
      md5: 90bd61f9b5a8993b951d386e129caff7
      size: 175
    - path: models/model_candidate.pkl
      hash: md5
      md5: a9bfbd84eec8e41f3a740e0f976123ea
      size: 215243
  register_model:
    cmd: python -m src.model.register_model
    deps:
    - path: models/metrics/evaluation.json
      hash: md5
      md5: bda226ec67b4b420ad9c6994d4349698
      size: 173
    - path: models/model.pkl
      hash: md5
      md5: a9bfbd84eec8e41f3a740e0f976123ea
      size: 215243
    - path: src/model/register_model.py
      hash: md5
      md5: 316636e78bdd8aa0e611d768113dfaaa
      size: 4589
    params:
      params.yaml:
        mlflow:
          tracking_uri: 
            https://dagshub.com/RitamRixx/hospital-readmission-risk-prediction.mlflow
          experiment_name: production-pipeline-New
          model_name: readmission-risk-lightgbm
          repo_owner: RitamRixx
          repo_name: hospital-readmission-risk-prediction
  drift_check:
    cmd: python -m src.monitoring.data_drift
    deps:
    - path: data/processed/featured_data.csv
      hash: md5
      md5: 89086eae43ce86ca571fd85a8c288d4a
      size: 622445
    - path: data/reference/reference_data.csv
      hash: md5
      md5: 89086eae43ce86ca571fd85a8c288d4a
      size: 622445
    - path: src/monitoring/data_drift.py
      hash: md5
      md5: ab7b8204c5b16e1e826e8d17e568bc2e
      size: 6973
    params:
      params.yaml:
        drift_monitoring:
          thresholds:
            drift_share: 0.2
            psi_threshold: 0.1
        paths.featured_data: data/processed/featured_data.csv
        paths.reference_data: data/reference/reference_data.csv
    outs:
    - path: models/drift_decision.json
      hash: md5
      md5: d772f9f364ea6ec61e9f41a92bafa49d
      size: 367
    - path: models/drift_report
      hash: md5
      md5: d99b04d078d20e1db22786569a461c0b.dir
      size: 3410339
      nfiles: 1
  model_compare:
    cmd: python -m src.model.model_compare
    deps:
    - path: data/final/test.csv
      hash: md5
      md5: 2ac92cf9fe5ca4b95cd4e32b0f9b0727
      size: 121654
    - path: models/model_candidate.pkl
      hash: md5
      md5: a9bfbd84eec8e41f3a740e0f976123ea
      size: 215243
    - path: src/model/model_compare.py
      hash: md5
      md5: 7f23131b5de18f86ae6ef753bb792d8a
      size: 5877
    params:
      params.yaml:
        encoding:
          num_cols:
          - age
          - time_in_hospital
          - num_lab_procedures
          - num_medications
          - number_emergency
          - number_inpatient
          - number_diagnoses
          - total_visits
          - num_med_changes
          - insulin_coded
          - interaction_visits_meds
          label_encode_cols:
          - gender
          - diabetesmed
          - metformin
          - change
          - diag_1_group
          target_encode_cols:
          - admission_type_id
          - discharge_disposition_id
          - admission_source_id
        feature_engineering.target:
          column_name: readmitted_binary
          source_column: readmitted
          mapping:
            <30: 1
            '>30': 0
            NO: 0
        model_comparison:
          primary_metric: f1
          min_improvement: 0.01
          threshold: 0.62
    outs:
    - path: models/deployment_decision.json
      hash: md5
      md5: 77bc6565908d3d1119750322f5e4a17d
      size: 393
